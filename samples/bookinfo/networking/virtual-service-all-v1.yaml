apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: productpage
spec:
  hosts:
  - productpage
  http:
  - route:
    - destination:
        host: productpage
        subset: v1
    requestTransform:
      orignal:
        headers:
          x-user-id: '{userId}'
        path: '/users/{pathId}'
      new:
        headers:
          x-new-user-id: '{{userId}}'
        path: '/users/new/{{userId}}/{{pathId}}'
        body:
          type: Body
          text: 'message from {{userId}}'
    responseTransform:
      orignal:
        headers:
          x-user-id: '{userId}'
        path: '/users/{pathId}'
      new:
        headers:
          x-new-user-id: '{{userId}}'
        path: '/users/new/{{userId}}/{{pathId}}'
        body:
          type: MergeExtractorsToBody
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
  - reviews
  http:
  - route:
    - destination:
        host: reviews
        subset: v1
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ratings
spec:
  hosts:
  - ratings
  http:
  - route:
    - destination:
        host: ratings
        subset: v1
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: details
spec:
  hosts:
  - details
  http:
  - route:
    - destination:
        host: details
        subset: v1
---
